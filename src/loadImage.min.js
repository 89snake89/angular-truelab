/**
 * @name angular-truelab
 * @description angular-truelab - Truelab angular modules
 * @version v0.0.0 - 2014-07-03 14:57
 * @link http://truelab.github.io/angular-truelab
 * @license MIT License, http://www.opensource.org/licenses/MIT
 **/

;(function( window, angular, undefined ){
"use strict";angular.module("truelab.loadImage",["ng"]).factory("$$image",function(){return{$new:function(){return new window.Image}}}).factory("$tlLoadImage",function(a,b,c){return{load:function(a,d){var e=this,f=b.defer(),g=c.$new();return g.onload=function(){e.__fn(g,d,f,"resolve")},g.onerror=function(){e.__fn(g,d,f,"reject")},g.src=a,f.promise},loadAll:function(a){var c=[],d=this;return angular.forEach(a,function(a){c.push(d.load(a))}),b.all(c)},__fn:function(b,c,d,e){angular.isDefined(c)&&0!==c?a(function(){d[e](b)},c||0):d[e](b)}}}).value("$tlLoadImageOptions",{delay:0,css:{base:"tl-load-image",loading:"loading",error:"error"}}).directive("tlLoadImage",function(a,b){function c(a,b,c){angular.forEach(a.prop("attributes"),function(a){angular.isArray(c)?c.indexOf(a.name)<0&&b.attr(a.name,a.value):b.attr(a.name,a.value)})}function d(a,b){return"tlLoadImage:"+a+(b?":"+b:"")}return{restrict:"EA",replace:!1,scope:!0,link:function(e,f,g){var h=e.$eval(g.tlLoadImageOptions)||{},i=f.children("img");h=angular.extend({},b,h),f.addClass(h.css.base),f.children("img").remove(),e.$watch(g.tlLoadImageOptions,function(a){angular.isObject(a)&&(h=angular.extend({},b,a))},!0),e.$watch(g.tlLoadImage,function(b){b&&(e.$emit(d("pending",h.eventId)),f.removeClass(h.css.error).addClass(h.css.loading),a.load(b,h.delay||0).then(function(a){var b=angular.element(a);c(i,b,["src","ng-src","tl-load-image"]),f.children("img").length>0?f.children("img").replaceWith(b):f.append(b)}).catch(function(){f.addClass(h.css.error)}).finally(function(){f.removeClass(h.css.loading),e.$emit(d("finally",h.eventId))}))})}}});
}(window, angular));