/**
 * @name angular-truelab
 * @description angular-truelab - Truelab angular modules
 * @version v0.0.0 - 2014-07-03 14:57
 * @link http://truelab.github.io/angular-truelab
 * @license MIT License, http://www.opensource.org/licenses/MIT
 **/

;(function( window, angular, undefined ){
"use strict";angular.module("truelab",["truelab._","truelab.loadImage","truelab.debounce","truelab.countdown","truelab.strings.filters"]),angular.module("truelab._",[]).constant("_",window._),angular.module("truelab.countdown",[]).factory("$tlCountdown",["$$TlCountdown",function(a){return{$new:function(b){return new a(b)}}}]).factory("$$TlCountdownLifecycle",function(){function a(){this.$$onStartFns=[],this.$$onStopFns=[],this.$$onExpireFns=[],this.$$onTickFns=[]}return a.prototype={start:function(a){return this.$$onStartFns.push(a),this},stop:function(a){return this.$$onStopFns.push(a),this},expire:function(a){return this.$$onExpireFns.push(a),this},tick:function(a){return this.$$onTickFns.push(a),this}},a}).factory("$$TlCountdown",["$$TlCountdownLifecycle","$timeout","$log",function(a,b,c){function d(a,b){var c=a.$lifecycle["$$"+b+"Fns"];angular.forEach(c,function(b){b.call(a)})}function e(a){return a.$seconds<=0?void a.stop():(a.$$running=!0,a.$running=!0,a.$$stopped=b(function(){return a.$$running=!0,a.$running=!0,a.$seconds--,a.$seconds<=0?(d(a,"onExpire"),a.$$expired=!0,a.$expired=!0,void a.stop()):(d(a,"onTick"),void e(a))},1e3),a.$$stopped)}function f(b){var c=this;c.$seconds=b.seconds||0,c.$lifecycle=new a,c.$running=!1,c.$expired=!1,c.$$seconds=c.$seconds,c.$$expired=!1,c.$$running=!1,c.$$stopped=void 0}return f.prototype.start=function(){var a=this;return a.$$expired===!0?void c.error("can't start expired countdown!"):a.$$running!==!1?void c.error("can't start already running!"):(d(a,"onStart"),void e(a))},f.prototype.stop=function(){var a=this;b.cancel(a.$$stopped),a.$$running=!1,a.$running=!1,d(a,"onStop")},f}]),angular.module("truelab.debounce",[]).directive("tlDebounce",["$timeout",function(a){var b={delay:1e3};return{restrict:"A",require:"ngModel",priority:99,link:function(c,d,e,f){if("radio"!==e.type&&"checkbox"!==e.type){d.unbind("input");var g,h,i;d.bind("input",function(){i=c.$eval(e.tlDebounce),h=i?i:0===i||"0"===i?i:b.delay,a.cancel(g),h?g=a(function(){c.$apply(function(){f.$setViewValue(d.val())})},h):c.$apply(function(){f.$setViewValue(d.val())})}),d.bind("blur",function(){c.$apply(function(){f.$setViewValue(d.val())})})}}}}]),function(a){var b=["focusin","focusout"],c=function(a){var b="tl"+(a.charAt(0).toUpperCase()+a.slice(1));return{name:b,declaration:["$parse",function(c){return function(d,e,f){var g=c(f[b]);e.bind(a,function(a){d.$apply(function(){g(d,{$event:a})})})}}]}};angular.forEach(b,function(b){var d=c(b);a.directive(d.name,d.declaration)}),a.directive("tlClickout",["$parse",function(a){function b(a){angular.element("body").bind("click",a)}function c(a){angular.element("body").unbind("click",a)}return function(d,e,f){var g=a(f.tlClickout),h=!1,i=function(a){var b=angular.element(a.target);b.closest(e).length||h===!0&&(h=!1,c(i),d.$apply(function(){g(d,{$event:a})}))};e.bind("click",function(){h=!0,b(i)})}}])}(angular.module("truelab.events",[])),angular.module("truelab.loadImage",["ng"]).factory("$$image",function(){return{$new:function(){return new window.Image}}}).factory("$tlLoadImage",["$timeout","$q","$$image",function(a,b,c){return{load:function(a,d){var e=this,f=b.defer(),g=c.$new();return g.onload=function(){e.__fn(g,d,f,"resolve")},g.onerror=function(){e.__fn(g,d,f,"reject")},g.src=a,f.promise},loadAll:function(a){var c=[],d=this;return angular.forEach(a,function(a){c.push(d.load(a))}),b.all(c)},__fn:function(b,c,d,e){angular.isDefined(c)&&0!==c?a(function(){d[e](b)},c||0):d[e](b)}}}]).value("$tlLoadImageOptions",{delay:0,css:{base:"tl-load-image",loading:"loading",error:"error"}}).directive("tlLoadImage",["$tlLoadImage","$tlLoadImageOptions",function(a,b){function c(a,b,c){angular.forEach(a.prop("attributes"),function(a){angular.isArray(c)?c.indexOf(a.name)<0&&b.attr(a.name,a.value):b.attr(a.name,a.value)})}function d(a,b){return"tlLoadImage:"+a+(b?":"+b:"")}return{restrict:"EA",replace:!1,scope:!0,link:function(e,f,g){var h=e.$eval(g.tlLoadImageOptions)||{},i=f.children("img");h=angular.extend({},b,h),f.addClass(h.css.base),f.children("img").remove(),e.$watch(g.tlLoadImageOptions,function(a){angular.isObject(a)&&(h=angular.extend({},b,a))},!0),e.$watch(g.tlLoadImage,function(b){b&&(e.$emit(d("pending",h.eventId)),f.removeClass(h.css.error).addClass(h.css.loading),a.load(b,h.delay||0).then(function(a){var b=angular.element(a);c(i,b,["src","ng-src","tl-load-image"]),f.children("img").length>0?f.children("img").replaceWith(b):f.append(b)}).catch(function(){f.addClass(h.css.error)}).finally(function(){f.removeClass(h.css.loading),e.$emit(d("finally",h.eventId))}))})}}}]),angular.module("truelab.strings.filters",[]).filter("tlTruncate",function(){return function(a,b,c){if(!angular.isString(a))return a;var d=angular.isNumber(b)?b:10,e=angular.isString(c)?c:"...";return a.length<=d||a.length-e.length<=d?a:a.substring(0,d-e.length)+e}});
}(window, angular));